# ERP DryMix Products - Supervisor Configuration
# Version: 1.0.0
# Description: Laravel queue worker and scheduler configuration

[program:erp-queue-worker]
# Process name
process_name=%(program_name)s_%(process_num)02d

# Command to run queue worker
command=php /var/www/erp/backend/artisan queue:work --sleep=3 --tries=3 --timeout=90 --daemon

# User to run as
user=www-data

# Auto-start and auto-restart
autostart=true
autorestart=true

# Number of processes
numprocs=4

# Working directory
directory=/var/www/erp/backend

# Priority (higher = starts first)
priority=10

# Stop signal
stopsignal=TERM

# Stop wait time
stopwaitsecs=600

# Redirect stdout and stderr
redirect_stderr=true
stdout_logfile=/var/log/supervisor/erp-queue-worker.log
stdout_logfile_maxbytes=50MB
stdout_logfile_backups=10

[program:erp-scheduler]
# Process name
process_name=%(program_name)s

# Command to run scheduler
command=php /var/www/erp/backend/artisan schedule:run --verbose --no-interaction

# User to run as
user=www-data

# Auto-start and auto-restart
autostart=true
autorestart=true

# Run every minute (using supervisor's stop/start cycle)
startsecs=0

# Working directory
directory=/var/www/erp/backend

# Priority
priority=20

# Stop signal
stopsignal=TERM

# Stop wait time
stopwaitsecs=10

# Redirect stdout and stderr
redirect_stderr=true
stdout_logfile=/var/log/supervisor/erp-scheduler.log
stdout_logfile_maxbytes=50MB
stdout_logfile_backups=10

[group:erp-queue]
programs=erp-queue-worker,erp-scheduler
priority=999
